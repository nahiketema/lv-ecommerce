<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Louis Vuitton</title>
    
    <!-- CSS Styles -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <nav class="nav-container">
            <a href="index.html" class="logo">LOUIS VUITTON</a>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="admin-dashboard.html">Dashboard</a></li>
                <li><a href="#" id="logoutLink">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- Admin Container -->
    <div class="admin-container">
        <!-- Admin Header -->
        <div class="admin-header">
            <h1>Admin Dashboard</h1>
            <p class="admin-welcome">Welcome, <span id="adminName"></span></p>
        </div>
        
        <!-- Alert Messages -->
        <div id="alertMessage" class="alert alert-success" style="display: none;"></div>
        <div id="errorMessage" class="alert alert-error" style="display: none;"></div>
        
        <!-- Admin Sections -->
        <div class="admin-sections">
            <!-- Product Management Section -->
            <div class="admin-section">
                <div class="section-header">
                    <h2>Product Management</h2>
                    <button class="toggle-form-btn" onclick="toggleProductForm()">+ Add New Product</button>
                </div>
                
                <!-- Add Product Form -->
                <div id="productForm" class="product-form hidden">
                    <h3 style="margin-bottom: 1.5rem;">Add New Product</h3>
                    <form id="addProductForm" enctype="multipart/form-data">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Product Name *</label>
                                <input type="text" name="name" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>Price ($) *</label>
                                <input type="number" name="price" class="form-control" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label>Category *</label>
                                <select name="category" class="form-control" required>
                                    <option value="">Select Category</option>
                                    <option value="Clothing">Clothing</option>
                                    <option value="Accessories">Accessories</option>
                                    <option value="Cosmetics">Cosmetics</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Product Image *</label>
                                <div class="file-input-wrapper">
                                    <label class="file-input-label" for="productImage">
                                        Choose Image File
                                    </label>
                                    <input type="file" name="image" id="productImage" accept="image/*" required>
                                </div>
                            </div>
                            <div class="form-group form-grid-full">
                                <label>Description *</label>
                                <textarea name="description" class="form-control" rows="4" required></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn" style="margin-top: 1rem;">Add Product</button>
                        <button type="button" class="btn btn-secondary" style="margin-top: 1rem; margin-left: 1rem;" onclick="toggleProductForm()">Cancel</button>
                    </form>
                </div>
                
                <!-- Products Table -->
                <div class="table-container">
                    <div id="productsLoading" class="loading-admin">Loading products...</div>
                    <table class="products-table" id="productsTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Orders Section -->
            <div class="admin-section">
                <div class="section-header">
                    <h2>Recent Orders</h2>
                </div>
                
                <div class="table-container">
                    <div id="ordersLoading" class="loading-admin">Loading orders...</div>
                    <table class="orders-table" id="ordersTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Total</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                    <div id="noOrders" style="display: none; text-align: center; padding: 2rem; color: #666;">
                        No orders placed yet.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>Louis Vuitton E-Commerce Admin Panel</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <p><a href="index.html">Main Site</a></p>
                    <p><a href="shop.html">Shop</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Louis Vuitton E-Commerce. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAccess();
            loadProducts();
            loadOrders();
            setupAddProductForm();
            setupLogout();
        });

        // Check if user is admin
        function checkAdminAccess() {
            const userData = sessionStorage.getItem('user');
            if (!userData) {
                alert('Please login to access admin panel');
                window.location.href = 'login.html';
                return;
            }
            
            const user = JSON.parse(userData);
            if (user.role !== 'admin') {
                alert('Access denied. Admin privileges required.');
                window.location.href = 'index.html';
                return;
            }
            
            document.getElementById('adminName').textContent = user.name;
        }

        // Toggle product form visibility
        function toggleProductForm() {
            const form = document.getElementById('productForm');
            form.classList.toggle('hidden');
            
            if (!form.classList.contains('hidden')) {
                document.getElementById('addProductForm').reset();
            }
        }

        // Load products
        async function loadProducts() {
            try {
                const response = await fetch('php/products/get_products.php');
                const data = await response.json();
                
                document.getElementById('productsLoading').style.display = 'none';
                
                if (data.success && data.products.length > 0) {
                    displayProducts(data.products);
                    document.getElementById('productsTable').style.display = 'table';
                } else {
                    document.getElementById('productsTableBody').innerHTML = 
                        '<tr><td colspan="6" style="text-align: center;">No products found</td></tr>';
                    document.getElementById('productsTable').style.display = 'table';
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showErrorMessage('Failed to load products');
            }
        }

        // Display products in table
        function displayProducts(products) {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td><img src="${product.image_path}" alt="${product.name}" class="product-thumb"></td>
                        <td>${product.name}</td>
                        <td>${product.category}</td>
                        <td>$${parseFloat(product.price).toFixed(2)}</td>
                        <td>
                            <div class="action-btns">
                                <button class="delete-btn" onclick="deleteProduct(${product.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Setup add product form
        function setupAddProductForm() {
            const form = document.getElementById('addProductForm');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(form);
                
                try {
                    const response = await fetch('php/admin/add_product.php', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccessMessage('Product added successfully!');
                        form.reset();
                        toggleProductForm();
                        loadProducts();
                    } else {
                        showErrorMessage(data.message || 'Failed to add product');
                    }
                } catch (error) {
                    console.error('Error adding product:', error);
                    showErrorMessage('An error occurred. Please try again.');
                }
            });
        }

        // Delete product
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                const formData = new FormData();
                formData.append('product_id', productId);
                
                const response = await fetch('php/admin/delete_product.php', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccessMessage('Product deleted successfully!');
                    loadProducts();
                } else {
                    showErrorMessage(data.message || 'Failed to delete product');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showErrorMessage('An error occurred. Please try again.');
            }
        }

        // Load orders
        async function loadOrders() {
            try {
                const response = await fetch('php/orders/get_orders.php');
                const data = await response.json();
                
                document.getElementById('ordersLoading').style.display = 'none';
                
                if (data.success && data.orders.length > 0) {
                    displayOrders(data.orders);
                    document.getElementById('ordersTable').style.display = 'table';
                } else {
                   document.getElementById('noOrders').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                showErrorMessage('Failed to load orders');
            }
        }

        // Display orders in table
        function displayOrders(orders) {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            orders.forEach(order => {
                const date = new Date(order.order_date).toLocaleDateString();
                const row = `
                    <tr>
                        <td>#${order.id}</td>
                        <td>${order.customer_name}</td>
                        <td>${order.customer_email}</td>
                        <td>$${parseFloat(order.total_amount).toFixed(2)}</td>
                        <td>${date}</td>
                        <td><span class="order-status">${order.status}</span></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Show success message
        function showSuccessMessage(message) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = message;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
            
            window.scrollTo(0, 0);
        }

        // Show error message
        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
            
            window.scrollTo(0, 0);
        }

        // Setup logout
        function setupLogout() {
            document.getElementById('logoutLink').addEventListener('click', async function(e) {
                e.preventDefault();
                await fetch('php/auth/logout.php');
                sessionStorage.clear();
                window.location.href = 'login.html';
            });
        }
    </script>
</body>
</html>
